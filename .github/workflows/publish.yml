name: publish

on:
  pull_request:
    branches: ["main"]

jobs:
  fetch-latest-document:
    name: Fetch the latest document from document server
    runs-on: ubuntu-latest
    env:
      FTP_SERVER: ${{ secrets.FTP_SERVER }}
      FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
      FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      FTP_SERVER_DIR: ${{ secrets.FTP_SERVER_DIR }}
    steps:
    - name: Fetch main branch
      uses: actions/checkout@v3
      with:
        ref: 'main'
    - name: Fetch the latest document
      run: |
        sudo -v ; curl https://rclone.org/install.sh | sudo bash
        config_file=~/.config/rclone/rclone.conf
        mkdir -p ~/.config/rclone
        echo "[contentsviewer]" > $config_file
        echo "type = ftp" >> $config_file
        echo "host = ${FTP_SERVER}" >> $config_file
        echo "user = ${FTP_USERNAME}" >> $config_file
        echo "pass = ${FTP_PASSWORD}" >> $config_file
        echo "tls = false" >> $config_file
        echo "explicit_tls = true" >> $config_file
        rclone config show

    # - name: Fetch the latest document
    #   uses: SamKirkland/FTP-Deploy-Action@v4.3.4
    #   with:
    #     server: ${{ secrets.FTP_SERVER }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ secrets.FTP_PASSWORD }}
    #     server-dir: ${{ secrets.FTP_SERVER_DIR }}
    #     protocol: ftps
    #     security: strict
    #     # dry-run: true
